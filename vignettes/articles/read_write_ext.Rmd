---
title: "Working with read and write functions"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(sfext)
library(dplyr)
```

[read_sf_ext()](https://elipousson.github.io/sfext/reference/read_sf_ext.html) calls one of four other functions depending on the input parameters. `read_sf_path` is similar to `sf::read_sf` but has a few additional features. It checks the existence of a file before reading, supports the creation of wkt_filter parameters based on a bounding box, and supports conversion of tabular data to simple feature objects.

```{r}
nc <- read_sf_ext(path = system.file("shape/nc.shp", package = "sf"))
# Equivalent: read_sf_path(system.file("shape/nc.shp", package = "sf"))

glimpse(nc)
```

```{r}
bbox <- as_bbox(nc[10,])

read_sf_ext(path = system.file("shape/nc.shp", package = "sf"), bbox = bbox) %>% 
  glimpse()
```

The second is `read_sf_url` that supports reading url that are already supported by `sf::read_sf` but also supports ArcGIS Feature Layers (using the [{esri2sf}](https://github.com/yonghah/esri2sf) package) and URLs for tabular data (including both CSV files and Google Sheets).

```{r}
read_sf_ext(
  url = "https://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Louisville/LOJIC_PublicSafety_Louisville/MapServer/1"
) %>% 
glimpse()
```

This also supports URLs for GitHub Gists (assuming the first file in the Gist is a spatial data file) or Google MyMaps.

```{r}
read_sf_ext(
  url = "https://www.google.com/maps/d/u/0/viewer?mid=1CEssu_neU7lx_vAZs5qpufOBoUQ&ll=-3.81666561775622e-14%2C0&z=1"
) %>% 
  glimpse()
```

The third `read_sf_pkg` can load spatial data from any installed package including exported data, files in the extdata folder, or data in a package-specific cache folder. This is particularly useful when working with spatial data packages such as [{mapbaltimore}](https://elipousson.github.io/mapbaltimore/) or [{mapmaryland}](https://elipousson.github.io/mapmaryland/).

These three functions all call `read_sf_query` rather than `sf::read_sf` to provide the a spatial filter using the bbox parameter or to create queries based on the name and name_col parameters.
