<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Count extended for working with sf objects — count_sf_ext • sfext</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Count extended for working with sf objects — count_sf_ext"><meta name="description" content="An extended version of dplyr::count() that makes it easier to count the
occurrences of features from data that intersect with features from a second
sf object (set by y) or created by passing x or data to st_make_grid_ext().
Similar to count_features() and the two functions may be combined in the
future."><meta property="og:description" content="An extended version of dplyr::count() that makes it easier to count the
occurrences of features from data that intersect with features from a second
sf object (set by y) or created by passing x or data to st_make_grid_ext().
Similar to count_features() and the two functions may be combined in the
future."><meta property="og:image" content="https://elipousson.github.io/sfext/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sfext</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction.html">Introduction to sfext</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/elipousson/sfext/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Count extended for working with sf objects</h1>
      <small class="dont-index">Source: <a href="https://github.com/elipousson/sfext/blob/main/R/count_sf_ext.R" class="external-link"><code>R/count_sf_ext.R</code></a></small>
      <div class="d-none name"><code>count_sf_ext.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>An extended version of <code><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">dplyr::count()</a></code> that makes it easier to count the
occurrences of features from data that intersect with features from a second
sf object (set by y) or created by passing x or data to <code><a href="st_make_grid_ext.html">st_make_grid_ext()</a></code>.
Similar to <code><a href="count_features.html">count_features()</a></code> and the two functions may be combined in the
future.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">count_sf_ext</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  join <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="va"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a></span>,</span>
<span>  largest <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  wt <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sort <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  replace_na <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  keep_na <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  lims <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  geometry <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Data to count in relationship to y</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>Optional sf object passed to <code><a href="st_make_grid_ext.html">st_make_grid_ext()</a></code>. Defaults to
<code>NULL</code>.</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>If <code>NULL</code> (default), y defaults to an <code>sf</code> object created by
<code><a href="st_make_grid_ext.html">st_make_grid_ext()</a></code> using x or data (if x is <code>NULL</code>) as the x parameter
for <code><a href="st_make_grid_ext.html">st_make_grid_ext()</a></code>. If not <code>NULL</code>, y must be an <code>sf</code> object that has
a column with the same name as .id (defaults to "id").</p></dd>


<dt id="arg-join">join<a class="anchor" aria-label="anchor" href="#arg-join"></a></dt>
<dd><p>geometry predicate function with the same profile as <a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a>; see details</p></dd>


<dt id="arg-largest">largest<a class="anchor" aria-label="anchor" href="#arg-largest"></a></dt>
<dd><p>logical; if <code>TRUE</code>, return <code>x</code> features augmented with the fields of <code>y</code> that have the largest overlap with each of the features of <code>x</code>; see https://github.com/r-spatial/sf/issues/578</p></dd>


<dt id="arg-wt">wt<a class="anchor" aria-label="anchor" href="#arg-wt"></a></dt>
<dd><p>&lt;<code><a href="https://rlang.r-lib.org/reference/args_data_masking.html" class="external-link">data-masking</a></code>&gt; Frequency weights.
Can be <code>NULL</code> or a variable:</p><ul><li><p>If <code>NULL</code> (the default), counts the number of rows in each group.</p></li>
<li><p>If a variable, computes <code>sum(wt)</code> for each group.</p></li>
</ul></dd>


<dt id="arg-sort">sort<a class="anchor" aria-label="anchor" href="#arg-sort"></a></dt>
<dd><p>If <code>TRUE</code>, will show the largest groups at the top.</p></dd>


<dt id="arg-replace-na">replace_na<a class="anchor" aria-label="anchor" href="#arg-replace-na"></a></dt>
<dd><p>If <code>TRUE</code>, replace NA values from count with 0.</p></dd>


<dt id="arg-keep-na">keep_na<a class="anchor" aria-label="anchor" href="#arg-keep-na"></a></dt>
<dd><p>If <code>TRUE</code>, filter NA values from count. Ignored if replace_na
is <code>TRUE</code>.</p></dd>


<dt id="arg-lims">lims<a class="anchor" aria-label="anchor" href="#arg-lims"></a></dt>
<dd><p>Optional numeric vector with minimum or both minimum and
maximum count values. If provided, any values below the minimum are set to
that minimum and any values above the maximum as set to the maximum. If
only one value is provided, it is assumed to be a minimum limit.</p></dd>


<dt id="arg-geometry">geometry<a class="anchor" aria-label="anchor" href="#arg-geometry"></a></dt>
<dd><p>If <code>TRUE</code> (default) return a <code>sf</code> object. If <code>FALSE</code>, return
a data frame.</p></dd>


<dt id="arg--id">.id<a class="anchor" aria-label="anchor" href="#arg--id"></a></dt>
<dd><p>A name to use for the cell id column. Defaults to "id".</p></dd>


<dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>The name of the new column in the output.</p>
<p>If omitted, it will default to <code>n</code>. If there's already a column called <code>n</code>,
it will use <code>nn</code>. If there's a column called <code>n</code> and <code>nn</code>, it'll use
<code>nnn</code>, and so on, adding <code>n</code>s until it gets a new name.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed on to <code><a href="st_make_grid_ext.html">st_make_grid_ext</a></code></p><dl><dt><code>ncol,nrow</code></dt>
<dd><p>Used to set n if either are not <code>NULL</code>; defaults to <code>NULL</code>.
row and id are added as columns to the grid if they are provided.</p></dd>

    <dt><code>gutter</code></dt>
<dd><p>Distance in units between each column cell; gutter effectively
serves as a margin as the negative buffer is applied to all cells
(including those at the edges of the grid).</p></dd>

    <dt><code>desc</code></dt>
<dd><p>If TRUE, reverse standard order of cell id numbering; defaults
<code>FALSE</code></p></dd>

    <dt><code>n</code></dt>
<dd><p>If n is NULL and square is <code>TRUE</code>, the grid is set automatically to
be 10 cells wide, Default: <code>NULL</code></p></dd>

    <dt><code>what</code></dt>
<dd><p>"polygons", "corners", "centers"; set to centers automatically if
style is "circle", "circle_offset" but a buffer is applied to return
circular polygons.</p></dd>

    <dt><code>style</code></dt>
<dd><p>Style of cell to return with options including "rect", "square",
"hex", "flat_top_hex", "circle", "circle_offset"</p></dd>

    <dt><code>filter</code></dt>
<dd><p>If <code>TRUE</code> (or if trim is <code>TRUE</code>) filter grid geometry by x
using <a href="st_filter_ext.html">st_filter_ext</a></p></dd>

    <dt><code>crs</code></dt>
<dd><p>Coordinate reference system of bounding box to return; defaults to
<code>NULL</code> which maintains the crs of the input object.</p></dd>

    <dt><code>unit</code></dt>
<dd><p>Units for buffer. Supported options include "meter", "foot",
"kilometer", and "mile", "nautical mile" Common abbreviations (e.g. "km"
instead of "kilometer") are also supported. Distance in units is converted
to units matching GDAL units for x; defaults to "meter"</p></dd>

    <dt><code>cellsize</code></dt>
<dd><p>numeric of length 1 or 2 with target cellsize: for square or rectangular cells the width and height, for hexagonal cells the distance between opposite edges (edge length is cellsize/sqrt(3)). A length units object can be passed, or an area unit object with area size of the square or hexagonal cell.</p></dd>

    <dt><code>trim</code></dt>
<dd><p>If <code>TRUE</code>, x is trimmed to y with <code><a href="st_erase.html">st_trim()</a></code>.</p></dd>


</dl></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A sf object or a tibble (if <code>geometry = FALSE</code>) with a column
counting occurrences of features from data.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shape/nc.shp"</span>, package <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html" class="external-link">st_sample</a></span><span class="op">(</span><span class="va">nc</span>, size <span class="op">=</span> <span class="fl">75</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Count data based on nc</span></span></span>
<span class="r-in"><span><span class="va">count</span> <span class="op">&lt;-</span> <span class="fu">count_sf_ext</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, y <span class="op">=</span> <span class="va">nc</span>, .id <span class="op">=</span> <span class="st">"FIPS"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>attribute variables are assumed to be spatially constant throughout all geometries</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">count</span><span class="op">[</span>, <span class="st">"n"</span><span class="op">]</span>, reset <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data</span>, col <span class="op">=</span> <span class="st">"gray60"</span>, pch <span class="op">=</span> <span class="fl">3</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="count_sf_ext-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Count data based grid created by passing nc to st_make_grid_ext</span></span></span>
<span class="r-in"><span><span class="va">count_grid</span> <span class="op">&lt;-</span> <span class="fu">count_sf_ext</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, x <span class="op">=</span> <span class="va">nc</span>, .id <span class="op">=</span> <span class="st">"FIPS"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>attribute variables are assumed to be spatially constant throughout all geometries</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">count_grid</span><span class="op">[</span>, <span class="st">"n"</span><span class="op">]</span>, reset <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data</span>, col <span class="op">=</span> <span class="st">"gray60"</span>, pch <span class="op">=</span> <span class="fl">3</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="count_sf_ext-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Eli Pousson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

